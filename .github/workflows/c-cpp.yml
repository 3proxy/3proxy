name: C/C++ CI

on:
  push:
    branches: [ "master" ]
    paths: [ '**.c', '**.h', 'Makefile.**', '.github/configs', '.github/workflows/c-cpp.yml' ]
  pull_request:
    branches: [ "master" ]
    paths: [ '**.c', '**.h', 'Makefile.**', '.github/configs', '.github/workflows/c-cpp.yml' ]

jobs:
  ci:
    name: "${{ matrix.target }}"
    strategy:
      matrix:
        target:
          - ubuntu-latest
    runs-on: ${{ matrix.target }}
    steps:
    - uses: actions/checkout@v4
#    - name: configure
#      run: ./configure
    - name: make
      run: make -f Makefile.Linux
    - name: mkdir
      run: mkdir ~/3proxy
    - name: make install
      run: make DESTDIR=~/3proxy -f Makefile.Linux install
    - name: make clean
      run: make -f Makefile.Linux clean
